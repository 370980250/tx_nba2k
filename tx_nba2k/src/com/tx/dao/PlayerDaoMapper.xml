<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tx.dao.PlayerDao">
<resultMap type="player" id="playerMap">
	<id column="id" property="id"/>
	<result column="ename" property="ename"/>
	<result column="cname" property="cname"/>
	<result column="tname" property="tname"/>
	<result column="position" property="position"/>
	<result column="ability" property="ability"/>
	<result column="round" property="round"/>
	<result column="price" property="price"/>
	<result column="badges" property="badges"/>
	<association javaType="grade" column="gid" property="grade" select="com.tx.dao.GradeDao.queryGradeById" ></association>
	<association property="team" column="tid" javaType="team" select="com.tx.dao.TeamDao.queryTeamById"></association>
	
</resultMap>
<insert id="addPlayer" parameterType="player">
	insert into tx_player(ename,cname,tname,position,ability,round,price,badges,gid) values(#{ename},#{cname},#{tname},#{position},#{ability},#{round},#{price},#{badges},#{grade.id})
	
</insert>

<select id="queryPlayerByGid" parameterType="partion" resultMap="playerMap">
	select * from tx_player where gid=#{grade.id} order by price desc
</select>

<select id="queryPlayerList" parameterType="partion" resultMap="playerMap">
	select * from (select n.*,rownum rn from (select * from tx_player 
	<where>
		gid = #{grade.id}
		<if test="query!=null">
			<if test="query.qname!=null and query.qname!=''">
				and ( Lower(ename) like concat('%',concat(#{query.qname},'%')) or cname  like concat('%',concat(#{query.qname},'%')))
			</if>
		</if>
	</where>
	order by price desc,ability desc
	 ) n) where rn >= #{start} and rn <![CDATA[<=]]> #{end}
</select>

<select id="getRowsCount" parameterType="partion" resultType="int">
	select count(1) from tx_player p 
	<where>
		gid = #{grade.id}
		<if test="query!=null">
			<if test="query.qname!=null and query.qname!=''">
				and ( Lower(ename) like concat('%',concat(#{query.qname},'%') )or cname  like concat('%',concat(#{query.qname},'%')))
			</if>
		</if>
	</where>
</select>

<select id="queryPlayerByTeam" parameterType="team" resultMap="playerMap">
	select * from tx_player where gid=#{grade.id} and tid=#{id} order by price desc
</select>

<update id="updatePlayerToTeam" parameterType="player">
	update tx_player 
	<trim prefix="set" suffixOverrides=",">
		<if test="team.id!=0">
			tid = #{team.id},
		</if>
	</trim>
		where id = #{id}
</update>
<select id="queryPlayerByTradeId" parameterType="int" resultMap="playerMap">
	select tt.* from tx_player tt, tx_tradeandplayer ttat where tt.id = ttat.pid and ttat.tid = #{tid}
</select>

<select id="queryPlayerById" parameterType="int" resultMap="playerMap">
	select * from tx_player where id = #{pid} or id =#{pid1} or id=#{pid2}
</select>
</mapper>